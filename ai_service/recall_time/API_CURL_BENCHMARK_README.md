# curl接口性能基准测试工具

本工具用于通过系统curl命令，自动化测试AI智能教学实训平台所有主要接口的端到端响应时间。每个接口多次测试，统计平均、最小、最大响应时间，结果自动输出到带时间戳的txt文件，便于归档和对比。

---

## 功能特点

- **curl原生调用**：直接用curl命令，结果权威、无Python解释器干扰
- **极简请求体**：所有POST接口均用最小必需字段，测得最短响应时间
- **多轮统计**：每个接口多次测试，输出平均、最小、最大响应时间
- **总览+详细**：结果文件包含总览表格和每次详细耗时
- **兼容性强**：支持Windows（CMD）、Linux、Mac
- **无需依赖第三方Python包**

---

## 测试接口列表

| 接口名称           | 端点                                 | 方法 | 说明                 |
|--------------------|--------------------------------------|------|----------------------|
| 健康检查           | `/health`                            | GET  | 服务状态检查         |
| 生成教学内容详情   | `/rag/detail`                        | POST | 极简教案生成         |
| 生成练习题         | `/rag/generate_exercise`             | POST | 极简练习题生成       |
| 评估主观题答案     | `/rag/evaluate_subjective`           | POST | 极简主观题评估       |
| 分析练习整体情况   | `/rag/analyze_exercise`              | POST | 极简练习分析         |
| 在线学习助手       | `/rag/assistant`                     | POST | 极简问答             |
| 生成学生自测练习   | `/rag/generate_student_exercise`     | POST | 极简自测练习         |
| 生成课程优化建议   | `/rag/optimize_course`               | POST | 极简课程优化建议     |

---

## 快速开始

### 1. 环境准备
- 确保AI服务已启动（如：`python -m ai_service.main`）
- 确保系统已安装curl（Windows 10/11自带，Linux/Mac默认有）

### 2. 运行脚本

```bash
python ai_service/recall/api_curl_benchmark.py
```

### 3. 查看结果
- 结果文件自动保存为 `curl_benchmark_YYYYMMDD_HHMMSS.txt`
- 控制台同步输出

---

## 输出文件格式

### 1. 总览表格

```
| 接口名称           | 平均响应时间(s) | 最小(s) | 最大(s) |
|--------------------|----------------|--------|--------|
| 生成教学内容详情   | 0.321          | 0.310  | 0.340  |
| 生成练习题         | 0.210          | 0.200  | 0.220  |
...（其余接口同上）
```

### 2. 详细分接口耗时

```
生成教学内容详情
  第1次: 0.321 秒
  第2次: 0.310 秒
  ...
```

---

## 参数说明

- **REPEAT**：每个接口测试次数（脚本内可修改，默认5）
- **极简请求体**：所有POST接口只发最小必需字段，内容极短，便于测最短响应时间
- **自动适配NUL/dev/null**：Windows和Linux/Mac均可用

---

## 适用场景

- 需要排除Python解释器、requests/httpx等库的影响，获得最权威的接口端到端耗时
- 需要批量、自动化对比所有接口的性能
- 需要归档、对比不同版本/不同环境下的接口响应速度
- 需要极简请求体下的最小业务链路耗时

---

## 注意事项

1. **本地测试时网络延迟可忽略**，结果几乎等于后端处理时间
2. **极简请求体仅用于性能基线测试**，不代表真实业务场景
3. **如需真实业务压力测试，请用完整请求体**
4. **如需更细粒度（如AI推理耗时），需在后端加日志**
5. **如需批量多轮测试，建议适当调整REPEAT，避免API额度消耗过快**

---

## 故障排查

- **curl未找到**：请确认系统已安装curl，Windows 10/11自带，Linux/Mac默认有
- **接口超时/失败**：检查AI服务是否正常运行，端口是否正确
- **输出文件乱码**：请用支持UTF-8的编辑器打开

---

## 示例输出

```
接口: 生成教学内容详情 (http://localhost:8000/rag/detail)
  第1次: 0.321 秒
  第2次: 0.310 秒
  ...
  平均响应时间: 0.315 秒  最小: 0.310 秒  最大: 0.321 秒

==================== 总览表 ====================
| 接口名称           | 平均响应时间(s) | 最小(s) | 最大(s) |
|--------------------|----------------|--------|--------|
| 生成教学内容详情   | 0.315          | 0.310  | 0.321  |
...（其余接口同上）

==================== 详细分接口耗时 ====================
生成教学内容详情
  第1次: 0.321 秒
  ...
```

---

如需自定义接口、请求体或统计方式，欢迎随时联系维护者！ 