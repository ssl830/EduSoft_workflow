# 学习记录导出功能测试计划

## 测试目标
验证学习记录页面的导出功能已成功从硬编码班级ID '1' 迁移到动态获取班级ID。

## 已完成的功能优化

### 1. 课程API增强 (`src/api/course.ts`)
- ✅ 添加了 `getUserClasses()` 方法获取用户所有班级
- ✅ 添加了 `getUserDefaultClass()` 方法获取用户默认班级

### 2. 学习记录页面重构 (`src/views/records/LearningRecords.vue`)
- ✅ 添加了班级信息动态获取功能
- ✅ 替换了所有硬编码的班级ID '1'
- ✅ 添加了班级信息显示界面
- ✅ 完善了错误处理机制

### 3. 文件下载功能验证
- ✅ 支持Excel (.xlsx) 和PDF (.pdf) 格式
- ✅ 正确处理Blob响应类型
- ✅ 适当的错误处理和用户反馈
- ✅ 自动生成带时间戳的文件名

## 测试步骤

### 前置条件
1. 确保后端API支持以下接口：
   - `GET /api/course/user/classes` - 获取用户班级列表
   - `GET /api/course/user/default-class` - 获取用户默认班级
   - 相关的导出API接口

### 功能测试

#### 1. 班级信息获取测试
- [ ] 以教师/助教身份登录
- [ ] 访问学习记录页面
- [ ] 验证页面顶部显示正确的班级信息（班级名称+课程名称）
- [ ] 检查控制台是否有班级获取相关错误

#### 2. 导出功能测试

**单个记录导出：**
- [ ] 点击某个练习记录的"导出Excel"按钮
- [ ] 验证下载的文件名包含正确的练习ID和时间戳
- [ ] 确认使用的是动态获取的班级ID（而非硬编码'1'）

**PDF报告下载：**
- [ ] 点击某个练习记录的"下载报告"按钮
- [ ] 验证下载的PDF文件正常
- [ ] 检查文件名格式正确

**全部记录导出：**
- [ ] 点击"导出全部记录"按钮
- [ ] 验证导出包含当前班级的所有学习记录
- [ ] 确认使用的是动态班级ID

#### 3. 错误处理测试
- [ ] 测试网络异常情况下的错误提示
- [ ] 测试无权限访问时的错误处理
- [ ] 测试班级信息获取失败时的回退机制

#### 4. 不同用户角色测试
- [ ] 学生角色：验证只能导出自己的记录
- [ ] 教师角色：验证能导出班级所有学生记录
- [ ] 助教角色：验证权限与教师一致

## 关键改进点

### 动态班级ID获取
```typescript
// 之前的硬编码方式
classId: '1'

// 现在的动态获取方式
classId: currentClass.value?.classId || '1'
```

### 班级信息显示
- 在页面顶部显示当前班级信息
- 提供班级获取失败的错误提示
- 支持多班级环境下的班级切换（预留功能）

### 错误处理改进
- 具体的HTTP状态码错误处理
- 用户友好的错误信息提示
- 网络异常的优雅降级

## 后端接口需求

确保以下API接口已实现：

1. **用户班级信息接口**
   ```
   GET /api/course/user/classes
   GET /api/course/user/default-class
   ```

2. **导出接口中班级ID参数支持**
   - 确保所有导出接口正确处理classId参数
   - 验证班级权限控制

## 预期结果
- ✅ 完全消除硬编码班级ID '1'
- ✅ 支持多班级环境
- ✅ 提供清晰的班级上下文信息
- ✅ 保持向后兼容性
- ✅ 文件下载功能正常工作
- ✅ 用户体验优化
